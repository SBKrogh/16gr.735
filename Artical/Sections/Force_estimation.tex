\section{Force estimation}\label{sec:force_estimation}
In order to have a representation of the reaction force on the EndoWrist, estimation is needed.
Because of the reasons mentioned in Section \ref{sec:system_overview}, the force cannot be measured using sensors and thus have to rely on mathematical models as functions of torque measurements.

\subsection{Mathematical model}
The main challenge faced in making a model lies in the fact that the pulley system on the EndoWrist is nonlinear, and thus its full dynamics cannot be modeled in a straightforward manner. 
The nonlinearity of EndoWrist dynamics emerges from friction and elasticity of the pulley strings controlling the end-effector, which causes multiple pulleys to move as a result of actuating only one. 
In other words, to have an accurate representation of Cartesian force a higher order nonlinear model is required.

Another method of tackling this problem lies in creating multiple mathematical models pertaining to forces output by actions performed with the EndoWrist.
In this manner, the feedback vector is transformed from Cartesian space to a task space in which the chosen actions form a basis.
Each element of the new feedback vector corresponds to an actuated axis of the Geomagic Touch.
For the purpose of this system, we choose to feedback the yaw force generated by the grip action of the clamp, the force generated by the roll actuator and force exerted by the clamps pitch movement, as seen in figure (the photo of ew).

\subsection{System Identification}
Ideally, a mathematical model derived from classical mechanics would be used to describe the dynamics involved in EndoWrist movement.
However, deriving this model precisely enough for grey-box identification has been proven difficult and time consuming due to the nonlinear nature of the dynamics (ref).


Models for yaw and pitch forces require the utilization of black box identification algorithms which only provide a general model structure. 
A straightforward approach would involve choosing a nonlinear model structure for identification.
On the other hand, stability analysis of nonlinear models is difficult and due to the nature of the system only general trends in force need to be represented.
For this reason it was decided to identify a linear state-space model which is then used as a part of Hammerstein-Wiener nonlinear model.

\begin{figure} 
\resizebox{0.9\linewidth}{!}{
\begin{tikzpicture}
\draw  (-3.5,3) rectangle (0,1) node[pos=.5] {Linear Block};
\draw  (-9,3) rectangle (-5.5,1) node[pos=.5] {Input Nonlinearity};
\draw  (2,3) rectangle (5.5,1) node[pos=.5] {Output Nonlinearity};
\draw [->] (-5.5,2) -- (-3.5,2) node [pos=0.5,above] {w(t)};
\draw [->] (-11,2) -- (-9,2) node [pos=0.5,above] {u(t)};
\draw [->] (0,2) -- (2,2) node [pos=0.5,above] {x(t)};
\draw [->] (5.45,2) -- (7.45,2) node [pos=0.5,above] {y(t)};
\end{tikzpicture}
}
\caption{Block diagram of a Hammerstein-Wiener model\ref{fig:weiner}}
\label{weiner}
\end{figure}

\subsubsection{Roll force}
The roll force, which is determined by the roll actuator and directly rotates the entire tool, making it independent to the rest of the system.
By simple measurement with the setup in figures \ref{fig:entire_force_testsetup} and \ref{fig:endeffector_force} we can interpret the roll force as determined by a feedthrough component in the state space model of the system.

\begin{align}
F_{roll} = m e_{roll} + b
\end{align}

 \begin{figure}[H]
 \centering
\includegraphics[width=\linewidth]{modelyaw_a}
\caption{Comparison of yaw model to measurements.}
\label{fig:final_res_yaw}
\end{figure}

\subsubsection{Pitch and yaw forces}
