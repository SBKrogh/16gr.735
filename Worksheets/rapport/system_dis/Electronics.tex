\section{Electronics}\label{sec:electronics}
% Small introduction to tikz figures and its basics, can be found on 
% http://cremeronline.com/LaTeX/minimaltikz.pdf
% Under the file tikz_magic.tex all the different boxes can be found!
%\subsection{Single board reconfigurable I/O}
\todo{We need to clean up this section flow. Hardware, electronics and mechanical system is mixed together..Especially the huge ass figure, this is confusing the way it is explained, since the explanation is split up.}

The electronic setup contains a \textbf{Single Board Reconfigurable Input/Output 9636} (sbRIO) controller, see \figref{fig:sbRIO9636}, which is responsible for interfacing between the surgical robot and the computer running the robotic operating system\cite{Chris_Surgical}, see \secref{sec:ros}. It reads the sensor measurements, sends them to the PC and controls the motors based on the received reference signals. The sbRIO has built in safety protocols that disable the motors in case of error.

\begin{figure}[H]
	\centering
		\centering
<		\includegraphics[width=0.7\linewidth]{sbRIO9636.png}
		\caption{The sbRIO 9636 board\cite{sbRIO9636Pic}}
		\label{fig:sbRIO9636}
\end{figure}


The controller consists of
\begin{itemize}
	\item 400 MHz real time processor
	\item 256 MB of system memory and 512 MB nonvolatile memory
	\item Reconfigurable Xilinx Spartan-6 LX45 FPGA
	\item 16 bit analog and digital I/O
	\item Built in USB, CAN, 10/100 Mb/s Ethernet peripherials
\end{itemize}

The board is configured through ethernet cable. The programs can be written in Labview, C or C++. In this project, LabView will be used due to the simplicity of coding the FPGA through a high level language. The board is capable of running Real-time. %code, which is unmatched on the ROS side.

% http://sine.ni.com/nips/cds/view/p/lang/en/nid/210421

\subsection{Hardware setup}
\todo{not really sure abouth this section, since it is explained in the next sections..}
The EndoWrist, see \secref{sec:Endowrist}, is actuated by 4 Maxon DC motors, see \secref{Maxon_Motor}. Each motor is equipped with an ESCON motor controller responsible for the cascade speed and inner loop current control. The control reference is sent through the sbRIO. They also provide current measurements to the sbRIO. Each motor hosts an encoder that provides relative angular position information to the FPGA built into the sbRIO board. For a graphical illustration of the connection see \figref{interface}.
%\input{rapport/system_dis/Eletronic_component.tex} % Old picture


\section{Motor}\label{Maxon_Motor}
The four motors for actuating the EndoWrist is sold as a bulk solution which include motor\cite{motor_motor}, gear\cite{motor_gear} and a position encoder\cite{motor_encoder}, see \figref{fig:Full_motor _dis}.
These motors are direct current (DC) motors. Some of the parameters for this bulk solution is listed below:

\begin{itemize}
\item Torque constant: $10.9\frac{\text{mNm}}{\text{A}}$
\item Nominal continues current: 0.681 A 
\item Gearing ratio: 1:19
\item Encoder precision: 512 counts pr. rotation. With the proper programming, see section \ref{encount}, 2048 positions can be distinguished in one rotation.
\end{itemize}

\begin{figure}[H]
	\centering
	\begin{subfigure}{.32\textwidth}
		\vspace{0pt}
		\centering
		\includegraphics[width=\linewidth]{motor.jpg}
		\caption{The Maxon 110160 \newline DC motor.}
		\label{fig:motor}
	\end{subfigure}
	\begin{subfigure}{.32\textwidth}
		\centering
		\includegraphics[width=\linewidth]{motor_gear.jpg}
		\caption{The planetary gearhead, 110356, equipped with sleeve bearing.}
		\label{fig:motor_gear}
	\end{subfigure}
	\begin{subfigure}{.32\textwidth}
	\hspace{5pt}
		\centering
		\includegraphics[width=\linewidth]{motor_sensor.jpg}
		\caption{The encoder, 201937, used for getting angular data.}
		\label{fig:motor_sensor}
	\end{subfigure}
	\caption{The combination gear disassembled}
	\label{fig:Full_motor _dis}
\end{figure}

The control of these motors are done through the sbRIO board, connected to a motor controllers, see \secref{sec:motor_control}.


\subsubsection{Encoder tick counting}\label{encount}
\todo{include somewhere that the encoder is build upon two sensors}
The FPGA has implemented encoder signal counter, that directly receives the signals from  the ESCON controller's two encoder sensors. One sensor is shifted by $90\deg$. The FPGA steps one unit each time the state of any of the sensor changes and FPGA compares the state of encoder A to the state of encoder B using a XOR function. This way the direction of the movement can be determined. The resulting position resolution is four times as high as the resolution of encoder lines.
\todo{on incoder lines?}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.5\columnwidth]{encoder.pdf}
	\caption{Encoder signal sensor states depending on position \cite{motor_encoder}.}
	\label{fig:encoder}
\end{figure}


%The ESCON motor controllers are attached to the sbRIO controller and send the control signals through cables. The motor has a nominal torque of 6.96 mNm.
%4 Maxon motors are used for the actuation of the endowrist. The motors are implemented using a combination gear (Maxon 353816) including the gearing, the servo motor and the sensors. The ESCON motor controllers are attached to the sbRIO controller and send the control signals through cables. The motor has a nominal torque of 6.96 mNm.



\subsection{ESCON 50/5 motor controller}\label{sec:motor_control}
For driving the motors, there has been implemented four ESCON motor driver of the type 50/5 (part number 438725), see \figref{fig:ESCON505}. 

\begin{figure}[H]
	\centering
		\centering
		\includegraphics[width=0.7\linewidth]{ESCON505.png}
		\caption{ESCON 50/5 DC motor controller\cite{ESCON_motor_controller}}
		\label{fig:ESCON505}
\end{figure}

These are controllers for permanent magnet-activated bushed DC motors an can deliver a power up to 250 Watt for the motor connected to the controller. 

It has three operating modes

\begin{itemize}
\item Current controller
\item Speed controller (open loop)
\item Speed controller (closed loop)
\end{itemize}

\todo{This sentence - No!
What are we going with and why?}
The reason we chose speed controller with inner loop control is explained in \ref{escon_con}.

\subsection{Interfacing}
\todo{linear flow?}
The interfacing between the subsystems have a linear flow, see \figref{interface}, each interface uses bidirectional communication. The communication between the Geomagic Touch and the computer, and the communication between the computer and the sbRIO both happen using UDP. The sbRIO's in-built microprocessor and FPGA communicates using onboard wires. The ESCON controller and the FPGA interfaces using electric wires. Information exchange between them happens using pwm signals for numeric data and digital signal for boolean data.

%\input{rapport/pictures/Daniel_Tikz.tex}

\input{rapport/system_dis/Mechanical_testsetup.tex}